{% extends 'cinema_app/base.html' %}

{% block content %}
<div class="container mt-4 text-center">
    <h1>Ваш платіж обробляється</h1>
    <p>Дякуємо за ваше замовлення! Ми підтверджуємо ваш платіж. Це може зайняти кілька секунд.</p>
    <p>Якщо платіж буде підтверджено, ви будете автоматично перенаправлені.</p>

    <hr>

    <h2>Деталі замовлення</h2>
    <p><strong>Номер замовлення:</strong> {{ order.id }}</p>
    <p><strong>Фільм:</strong> {{ order.session.movie.title }}</p>
    <p><strong>Сеанс:</strong> {{ order.session.start_time }} {{ order.session.session_date }}</p>
    <p><strong>Місця:</strong> {{ order.get_seat_numbers|join:', ' }}</p>
    <p><strong>Сума:</strong> {{ order.total_price }} грн</p>
</div>
{% endblock %}

<script>
    const checkStatus = () => {
        fetch(`/order-status/{{ order.id }}/`)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'COMPLETED') {
                    window.location.href = `/purchase-success/{{ order.id }}/`;
                }
            })
            .catch(error => console.error('Ошибка при обновлении статуса', error));
    };
    
    setInterval(checkStatus, 3000);
</script>
